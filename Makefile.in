# 
#	HCIDump - HCI packet analyzer
#	Copyright (C) 2000-2001 Maxim Krasnyansky <maxk@qualcomm.com>
#
#	This program is free software; you can redistribute it and/or modify
#	it under the terms of the GNU General Public License version 2 as
#	published by the Free Software Foundation;
#
#	THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
#	OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
#	FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT OF THIRD PARTY RIGHTS.
#	IN NO EVENT SHALL THE COPYRIGHT HOLDER(S) AND AUTHOR(S) BE LIABLE FOR ANY CLAIM,
#	OR ANY SPECIAL INDIRECT OR CONSEQUENTIAL DAMAGES, OR ANY DAMAGES WHATSOEVER
#	RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT,
#	NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE
#	USE OR PERFORMANCE OF THIS SOFTWARE.
#
#	ALL LIABILITY, INCLUDING LIABILITY FOR INFRINGEMENT OF ANY PATENTS, COPYRIGHTS,
#	TRADEMARKS OR OTHER RIGHTS, RELATING TO USE OF THIS SOFTWARE IS DISCLAIMED.
#
#
#  $Id$
#
.EXPORT_ALL_VARIABLES:
CONFIGURE_FILES = Makefile config.status config.cache config.h config.log

UTILS   = hcidump
PARSER  = parser/libparser.a

DUMP_OBJS = hcidump.o

SBINDIR = /usr/sbin
BINDIR  = /bin
ETCDIR  = /etc

CC	= @CC@
INSTALL = @INSTALL@

DEFS = @DEFS@

# optimization is necessary to compile the "extern inline" functions
CFLAGS  = @CFLAGS@ $(DEFS) -I . -I ./parser
CPPFLAGS = @CPPFLAGS@

LDFLAGS = @LDFLAGS@

LIBS    = -L./parser -lparser @LIBS@

PARTS   = @PARTS@

all: $(UTILS)

$(PARSER): force
	@$(MAKE) -C parser all

hcidump: $(PARSER) $(PARTS) $(DUMP_OBJS)
	$(CC) $(CFLAGS) $(CPPFLAGS) $(LDFLAGS) $(DUMP_OBJS) $(PARTS) \
		-o hcidump $(LIBS)

install: all
	$(INSTALL) -m 755 -o root -g root $(UTILS) $(SBINDIR)

clean:
	@$(MAKE) -C parser clean || true
	-rm -f *.o *.tab.* *.lex.* $(UTILS)

distclean: clean
	@$(MAKE) -C parser distclean || true
	-rm -f bluetooth
	-rm -f $(CONFIGURE_FILES)
	-rm -rf autom4te*.cache

force:;
